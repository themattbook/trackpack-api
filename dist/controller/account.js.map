{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","Account","register","username","body","email","password","err","account","send","passport","authenticate","session","status","scope","generateAccessToken","respond","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAkB;AAAA,MAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,MAARC,EAAQ,QAARA,EAAQ;;AAC/B,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChCC,sBAAQC,QAAR,CAAiB,IAAID,iBAAJ,CAAY;AAC3BE,gBAAUJ,IAAIK,IAAJ,CAASC;AADQ,KAAZ,CAAjB,EAEIN,IAAIK,IAAJ,CAASE,QAFb,EAEuB,UAASC,GAAT,EAAaC,OAAb,EAAsB;AACzC,UAAID,GAAJ,EAAS;AACPP,YAAIS,IAAJ,CAASF,GAAT;AACD;;AAEDG,yBAASC,YAAT,CACE,OADF,EACW;AACPC,iBAAS;AADF,OADX,EAGGb,GAHH,EAGQC,GAHR,EAGa,YAAM;AACjBA,YAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,kCAArB;AACH,OALC;AAMH,KAbD;AAcD,GAfH;;AAiBA;AACAZ,MAAIC,IAAJ,CAAS,QAAT,EAAmBY,mBAASC,YAAT,CACjB,OADiB,EACR;AACPC,aAAS,KADF;AAEPE,WAAO;AAFA,GADQ,CAAnB,EAIMC,mCAJN,EAI2BC,uBAJ3B;;AAMA;AACAnB,MAAIoB,GAAJ,CAAQ,SAAR,EAAmBN,4BAAnB,EAAiC,UAACZ,GAAD,EAAMC,GAAN,EAAc;AAC7CA,QAAIkB,MAAJ;AACAlB,QAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,0BAArB;AACD,GAHD;;AAKAZ,MAAIoB,GAAJ,CAAQ,KAAR,EAAeN,4BAAf,EAA6B,UAACZ,GAAD,EAAMC,GAAN,EAAc;AACzCA,QAAIa,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqBpB,IAAIqB,IAAzB;AACD,GAFD;;AAIA,SAAOvB,GAAP;AACD,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nexport default ({config, db}) => {\n  let api = Router();\n\n  // '/v1/account'\n  api.post('/register', (req, res) => {\n      Account.register(new Account({\n        username: req.body.email\n      }), req.body.password, function(err,account) {\n          if (err) {\n            res.send(err);\n          }\n\n          passport.authenticate(\n            'local', {\n              session: false\n          })(req, res, () => {\n            res.status(200).send('Successfully created new account');\n        });\n      });\n    });\n\n  // '/v1/account/login'\n  api.post('/login', passport.authenticate(\n    'local', {\n      session: false,\n      scope: []\n    }), generateAccessToken, respond);\n\n  // '/v1/account/logout'\n  api.get('/logout', authenticate, (req, res) => {\n    res.logout();\n    res.status(200).send('Successfully logged out.');\n  });\n\n  api.get('/me', authenticate, (req, res) => {\n    res.status(200).json(req.user);\n  });\n\n  return api;\n}\n"]}