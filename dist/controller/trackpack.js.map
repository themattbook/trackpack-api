{"version":3,"sources":["../../src/controller/trackpack.js"],"names":["config","db","api","date","Date","toISOString","get","req","res","TrackPack","find","err","trackpacks","send","json","post","authenticate","newTrackPack","name","body","desc","geometry","coordinates","lastupdate","save","message","findById","params","id","trackpack","put","delete","remove","_id"],"mappings":"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","file":"trackpack.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport TrackPack from '../model/trackpack';\n\nimport { authenticate } from '../middleware/authMiddleware';\n\nexport default({ config, db }) => {\n    let api = Router();\n    let date = new Date().toISOString();\n\n\n    // CRUD - Create Read Update Delete\n\n    // '/v1/trackpack' - Read\n    api.get('/', (req, res) => {\n      TrackPack.find({}, (err, trackpacks) => {\n        if (err) {\n          res.send(err);\n        }\n        res.json(trackpacks);\n      });\n    });\n\n    // '/v1/trackpack/add' - Create\n    api.post('/add', authenticate, (req, res ) => {\n      let newTrackPack = new TrackPack();\n      newTrackPack.name = req.body.name;\n      newTrackPack.desc = req.body.desc;\n      newTrackPack.geometry.coordinates = req.body.geometry.coordinates;\n      newTrackPack.geometry.lastupdate = date;\n\n      newTrackPack.save(err => {\n        if (err) {\n          res.send(err);\n        }\n        res.json({ message: 'TrackPack device created successfully.' });\n      });\n    });\n\n    // '/v1/trackpack/:id' - Read 1\n    api.get('/:id', (req, res) => {\n      TrackPack.findById(req.params.id, (err, trackpack) => {\n        if (err) {\n          res.send(err);\n        }\n        res.json(trackpack);\n      });\n    });\n\n    // '/v1/trackpack/name/:id' - Update Name\n    api.put('/name/:id', authenticate, (req, res) => {\n      TrackPack.findById(req.params.id, (err, trackpack) => {\n        if (err) {\n          res.send(err);\n        }\n        trackpack.name = req.body.name;\n        trackpack.save(err => {\n          if (err) {\n            res.send(err);\n          }\n          res.json({ message: \"TrackPack name updated.\" });\n        });\n      });\n    });\n\n    // '/v1/trackpack/desc/:id' - Update Description\n    api.put('/desc/:id', authenticate, (req, res) => {\n      TrackPack.findById(req.params.id, (err, trackpack) => {\n        if (err) {\n          res.send(err);\n        }\n        trackpack.desc = req.body.desc;\n        trackpack.save(err => {\n          if (err) {\n            res.send(err);\n          }\n          res.json({ message: \"TrackPack description updated.\" });\n        });\n      });\n    });\n\n    // '/v1/trackpack/geo/:id' - Update Coordinates\n    api.put('/geo/:id', (req, res) => {\n      TrackPack.findById(req.params.id, (err, trackpack) => {\n        if (err) {\n          res.send(err);\n        }\n        trackpack.geometry.coordinates = req.body.geometry.coordinates;\n        trackpack.geometry.lastupdate = date;\n        trackpack.save(err => {\n          if (err) {\n            res.send(err);\n          }\n          res.json({ message: \"Coordinates updated.\" });\n        });\n      });\n    });\n\n    // '/v1/trackpack/delete/:id' - Delete\n    api.delete('/delete/:id', authenticate, (req, res) => {\n      TrackPack.remove({\n          _id: req.params.id\n      }, (err, trackpack) => {\n        if (err) {\n          res.send(err);\n        }\n        res.json({ message: \"TrackPack device successfully removed.\" });\n      });\n    });\n\n\n    return api;\n}\n"]}